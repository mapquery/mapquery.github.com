(function($){$.MapQuery=$.MapQuery||{};$.MapQuery.Map=function(b,c){var d=this;if(c){if(!c.maxResolution&&c.maxExtent&&c.projection){c.maxResolution=(c.maxExtent[2]-c.maxExtent[0])/256}}this.options=$.extend({},new $.fn.mapQuery.defaults.map(),c);this.element=b;this.olMapOptions=$.extend({},this.options);delete this.olMapOptions.layers;delete this.olMapOptions.maxExtent;delete this.olMapOptions.zoomToMaxExtent;this.maxExtent=this.options.maxExtent;this.olMapOptions.maxExtent=new OpenLayers.Bounds(this.maxExtent[0],this.maxExtent[1],this.maxExtent[2],this.maxExtent[3]);OpenLayers.IMAGE_RELOAD_ATTEMPTS=3;OpenLayers.Util.onImageLoadErrorColor="transparent";this.olMap=new OpenLayers.Map(this.element[0],this.olMapOptions);this.olMap.addLayer(new OpenLayers.Layer('fake',{baseLayer:true}));this.vectorLayers=[];this.selectFeatureControl=null;this.idCounter=0;b.data('mapQuery',this);this.layersList={};this.events=$({});var e={};$.each(this.olMap.EVENT_TYPES,function(i,a){e[a]=function(){d.events.trigger(a,arguments)}});this.olMap.events.on(e);if(this.options.layers!==undefined){this.layers(this.options.layers)}if(this.options.zoomToMaxExtent){this.olMap.zoomToMaxExtent()}};$.MapQuery.Map.prototype={layers:function(b){var c=this;switch(arguments.length){case 0:return this._allLayers();case 1:if(!$.isArray(b)){return this._addLayer(b)}else{return $.map(b,function(a){return c._addLayer(a)})}break;default:throw('wrong argument number');}},_allLayers:function(){var d=[];$.each(this.layersList,function(a,b){var c=[b.position(),b];d.push(c)});var e=d.sort(function compare(a,b){return a[0]-b[0]});var f=$.map(e,function(a){return a[1]});return f.reverse()},_addLayer:function(a){var b=this._createId();var c=new $.MapQuery.Layer(this,b,a);this.layersList[b]=c;if(c.isVector){this.vectorLayers.push(b)}this._updateSelectFeatureControl(this.vectorLayers);this.events.trigger('mqAddLayer',c);return c},_createId:function(){return'mapquery'+this.idCounter++},_removeLayer:function(b){this.vectorLayers=$.grep(this.vectorLayers,function(a){return a!=b});this._updateSelectFeatureControl(this.vectorLayers);this.events.trigger('mqRemoveLayer',b);delete this.layersList[b];return this},goto:function(a){var b;var c;var d=null;var e;var f;if(a&&a.projection){d=a.projection.CLASS_NAME==='OpenLayers.Projection'?a.projection:new OpenLayers.Projection(a.projection)}else{var g=this.olMap.displayProjection;if(!g){d=new OpenLayers.Projection('EPSG:4326')}else{d=g.CLASS_NAME==='OpenLayers.Projection'?g:new OpenLayers.Projection(g)}}if(arguments.length===0){b=this.olMap.getCenter();e=this.olMap.getZoom();f=this.olMap.getExtent();c=this.olMap.getProjectionObject();if(!c.equals(d)){b.transform(c,d)}f.transform(c,d);f=f!==null?f.toArray():[];return{position:[b.lon,b.lat],zoom:this.olMap.getZoom(),box:f}}if(a.box!==undefined){c=this.olMap.getProjectionObject();f=new OpenLayers.Bounds(a.box[0],a.box[1],a.box[2],a.box[3]);if(!c.equals(d)){f.transform(d,c)}this.olMap.zoomToExtent(f)}else if(a.position===undefined){this.olMap.zoomTo(a.zoom)}else{b=new OpenLayers.LonLat(a.position[0],a.position[1]);c=this.olMap.getProjectionObject();if(!c.equals(d)){b.transform(d,c)}this.olMap.setCenter(b,a.zoom)}},_updateSelectFeatureControl:function(a){var b=[];var c=this.layersList;if(this.selectFeatureControl!==null){this.selectFeatureControl.deactivate();this.selectFeatureControl.destroy()}$.each(a,function(){b.push(c[this].olLayer)});this.selectFeatureControl=new OpenLayers.Control.SelectFeature(b);this.olMap.addControl(this.selectFeatureControl);this.selectFeatureControl.activate()},bind:function(){this.events.bind.apply(this.events,arguments)},one:function(){this.events.one.apply(this.events,arguments)},destroy:function(){this.olMap.destroy();this.element.removeData('mapQuery')}};$.MapQuery.Layer=function(b,c,d){var e=this;this.id=c;this.label=d.label||this.id;this.map=b;this.isVector=false;this.events=$({});var f=$.MapQuery.Layer.types[d.type.toLowerCase()].call(this,d);this.olLayer=f.layer;this.options=f.options;var g={};$.each(this.olLayer.EVENT_TYPES,function(i,a){g[a]=function(){e.events.trigger(a,arguments);e.map.events.trigger(a,arguments)}});this.olLayer.events.on(g);this.map.olMap.addLayer(this.olLayer)};$.MapQuery.Layer.prototype={down:function(a){a=a||1;var b=this.position();b=b-a;if(b<0){b=0}this.position(b);return this},each:function(){},remove:function(){this.map.olMap.removeLayer(this.olLayer);return this.map._removeLayer(this.id)},position:function(a){if(a===undefined){return this.map.olMap.getLayerIndex(this.olLayer)-1}else{return this.map.olMap.setLayerIndex(this.olLayer,a+1)}},up:function(a){a=a||1;var b=this.position();b=b+a;this.position(b);return this},visible:function(a){if(a===undefined){return this.olLayer.getVisibility()}else{this.olLayer.setVisibility(a);return this}},opacity:function(a){if(a===undefined){var b=this.olLayer.opacity?this.olLayer.opacity:this.olLayer.getVisibility();return b}else{this.olLayer.setOpacity(a);return this}},bind:function(){this.events.bind.apply(this.events,arguments)},one:function(){this.events.one.apply(this.events,arguments)}};$.fn.mapQuery=function(b){return this.each(function(){var a=$.data(this,'mapQuery');if(!a){$.data(this,'mapQuery',new $.MapQuery.Map($(this),b))}})};$.extend($.MapQuery.Layer,{types:{bing:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.bing,a);var b=o.view;switch(b){case'road':b='Road';break;case'hybrid':b='AerialWithLabels';break;case'satellite':b='Aerial';break}return{layer:new OpenLayers.Layer.Bing({type:b,key:o.key}),options:o}},ecwp:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.raster,a);return{layer:new OpenLayers.Layer.ECWP(o.label,o.url,o),options:o}},google:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.google,a);var b=o.view;switch(b){case'road':b=google.maps.MapTypeId.ROADMAP;break;case'terrain':b=google.maps.MapTypeId.TERRAIN;break;case'hybrid':b=google.maps.MapTypeId.HYBRID;break;case'satellite':b=google.maps.MapTypeId.SATELLITE;break}return{layer:new OpenLayers.Layer.Google({type:b}),options:o}},vector:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.vector,a);this.isVector=true;return{layer:new OpenLayers.Layer.Vector(o.label),options:o}},json:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.vector,a);this.isVector=true;var b=[];for(var i in o.strategies){if(o.strategies.hasOwnProperty(i)){switch(o.strategies[i].toLowerCase()){case'bbox':b.push(new OpenLayers.Strategy.BBOX());break;case'cluster':b.push(new OpenLayers.Strategy.Cluster());break;case'filter':b.push(new OpenLayers.Strategy.Filter());break;case'fixed':b.push(new OpenLayers.Strategy.Fixed());break;case'paging':b.push(new OpenLayers.Strategy.Paging());break;case'refresh':b.push(new OpenLayers.Strategy.Refresh());break;case'save':b.push(new OpenLayers.Strategy.Save());break}}}var c={protocol:new OpenLayers.Protocol.HTTP({url:o.url,format:new OpenLayers.Format.GeoJSON()}),strategies:b};return{layer:new OpenLayers.Layer.Vector(o.label,c),options:o}},osm:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.osm,a);return{layer:new OpenLayers.Layer.OSM(a),options:o}},wms:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.raster,a);var b={layers:o.layers,transparent:o.transparent,format:o.format};return{layer:new OpenLayers.Layer.WMS(o.label,o.url,b,o),options:o}},wmts:function(a){var o=$.extend(true,{},$.fn.mapQuery.defaults.layer.all,$.fn.mapQuery.defaults.layer.wmts);if(a.sphericalMercator===true){$.extend(true,o,{maxExtent:new OpenLayers.Bounds(-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339),maxResolution:156543.0339,numZoomLevels:19,projection:'EPSG:900913',units:'m'})}$.extend(true,o,a);var b=$.extend(true,{},o);if(b.url.charAt(b.url.length-1)==='/'){b.url=b.url.slice(0,b.url.length-1)}if(o.layer===undefined&&o.matrixSet===undefined&&o.style===undefined){var c=$.MapQuery.util.parseUri(b.url);var d=c.path.split('/');var e=d.slice(d.length-3);b.url=c.protocol?c.protocol+'://':'';b.url+=c.authority+d.slice(0,d.length-4).join('/');b.layer=e[0];b.style=e[1];b.matrixSet=e[2]}return{layer:new OpenLayers.Layer.WMTS(b),options:o}}}});$.fn.mapQuery.defaults={map:function(){return{allOverlays:true,controls:[new OpenLayers.Control.Navigation({documentDrag:true,dragPanOptions:{interval:1,enableKinetic:true}}),new OpenLayers.Control.ArgParser(),new OpenLayers.Control.Attribution()],format:'image/png',maxExtent:[-128*156543.0339,-128*156543.0339,128*156543.0339,128*156543.0339],maxResolution:156543.0339,numZoomLevels:19,projection:'EPSG:900913',displayProjection:'EPSG:4326',zoomToMaxExtent:true,units:'m'}},layer:{all:{isBaseLayer:false,displayOutsideMaxExtent:false},bing:{transitionEffect:'resize',view:'road',sphericalMercator:true},google:{transitionEffect:'resize',view:'road',sphericalMercator:true},osm:{transitionEffect:'resize',sphericalMercator:true},raster:{transparent:true},vector:{strategies:['fixed']},wmts:{format:'image/jpeg',requestEncoding:'REST',sphericalMercator:false}}};$.MapQuery.util={};$.MapQuery.util.parseUri=function(d){var o=$.MapQuery.util.parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(d),uri={},i=14;while(i--){uri[o.key[i]]=m[i]||""}uri[o.q.name]={};uri[o.key[12]].replace(o.q.parser,function(a,b,c){if(b){uri[o.q.name][b]=c}});return uri};$.MapQuery.util.parseUri.options={strictMode:false,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}})(jQuery);(function($,f){$.extend($.fn.mapQuery.defaults.layer.all,{legend:{url:'',msg:''}});LEGEND_ERRORS=['E_ZOOMOUT','E_ZOOMIN','E_OUTSIDEBOX'];$.extend(f.Layer.prototype,{legend:function(a){var b=this.map.goto();if(arguments.length===0){this._checkZoom(b);if(this.options.legend.msg==''){this._checkBox(b)}return this.options.legend}if(a.url!==undefined){this.options.legend.url=a.url;return this.options.legend}},_checkBox:function(a){var b=this.options.maxExtent;if(b!==undefined){var c=new OpenLayers.Bounds(a.box[0],a.box[1],a.box[2],a.box[3]);var d=new OpenLayers.Bounds(b[0],b[1],b[2],b[3]);var e=d.containsBounds(c,true);this.options.legend.msg=e?'':LEGEND_ERRORS[2]}},_checkZoom:function(a){var b=a.zoom;var c=this.options.maxZoom;var d=this.options.minZoom;this.options.legend.msg=(c!==undefined&&c<b)?LEGEND_ERRORS[0]:'';this.options.legend.msg=(d!==undefined&&d>b)?LEGEND_ERRORS[1]:''}})})(jQuery,$.MapQuery);(function($,d){$.extend(d.Map.prototype,{pixelsFromPosition:function(x,y){var a;var b=new OpenLayers.LonLat(x,y);var c=this.olMap.getExtent().containsLonLat(b);if(c){a=this.olMap.getViewPortPxFromLonLat(b);return[Math.round(a.x),Math.round(a.y)]}return null},pan:function(a,b){this.olMap.pan(a,b)}});$.extend(d.Layer.prototype,{zIndex:function(){return this.olLayer.getZIndex()},unselectFeature:function(a){this.map.selectFeatureControl.unselect(a)}});$.extend(d,{getFeaturePosition:function(a){var b=a.geometry.getCentroid().getBounds().getCenterLonLat();return[b.lon,b.lat]}})})(jQuery,$.MapQuery);(function($){$.template('mqFeatureInfo','<div class="mq-featureinfo ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+'<span class="ui-dialog-title">${title}</span>'+'</div>'+'<div" class="ui-dialog-content ui-widget-content">{{html contents}}</div>');$.widget("mapQuery.mqFeatureInfo",{options:{map:undefined,contents:undefined,title:"Feature information"},_create:function(){var b;var c=this;var d=this.element;b=$(this.options.map).data('mapQuery');var e=$.map(b.layers(),function(a){return a.isVector?a:null});$.each(e,function(){var a=this;a.bind("featureselected",{widget:c},c._onFeatureselected);a.bind("featureunselected",{widget:c},c._onFeatureunselected)});this.element.addClass('ui-dialog ui-widget ui-widget-content '+'ui-corner-all')},_destroy:function(){this.element.removeClass('ui-dialog ui-widget ui-widget-content '+'ui-corner-all').empty()},_onFeatureselected:function(a,b){var c=a.data.widget;var d=c.element;var e=c.options.contents.call(this,b.feature);d.html($.tmpl('mqFeatureInfo',{title:c.options.title,contents:e}))},_onFeatureunselected:function(a,b){var c=a.data.widget;c.element.empty()}})})(jQuery);(function($){$.template('mqLayerControl','<li id="mq-layercontrol-${id}" class="mq-layercontrol ui-widget-content ui-helper-clearfix ui-corner-all">'+'<span><div class="ui-icon ui-icon-arrowthick-2-n-s"></div><div class="mq-layercontrol-label">${label}</div>'+'<button class="mq-layercontrol-delete">Delete</button>'+'<input type="checkbox" class="mq-layercontrol-visibility" id="${id}-visibility" checked="${visible}" />'+'<label for="${id}-visibility">Visible</label></span>'+'</li>');$.widget("mapQuery.mqLayerControl",{options:{map:undefined},_create:function(){var j;var k=this;var l=this.element;j=$(this.options.map).data('mapQuery');l.append('<ul class=" ui-widget"></ul>');var m=l.children('ul');$.each(j.layers().reverse(),function(){k._add(m,this)});l.find('button').button();m.sortable({axis:'y',update:function(e,f){var g=f.item.siblings().andSelf();var h=g.length-1;g.each(function(i){var a=$(this).data('layer');var b=h-i;var c=$('span.label',this);var d=c.children();a.position(b);c.text(a.label).prepend(d)})}});l.delegate('.mq-layercontrol-visibility','change',function(){var a=$(this);var b=a.parents('li').data('layer');var c=a.attr('checked')?true:false;b.visible(c)});l.delegate('button','click',function(){var a=$(this).parents('li');k._remove(a.data('layer').id)});j.bind("mqAddLayer",{widget:k,map:j,control:m},k._onLayerAdd);j.bind("mqRemoveLayer",{widget:k},k._onLayerRemove)},_destroy:function(){this.element.removeClass('ui-widget ui-helper-clearfix '+'ui-corner-all').empty()},_add:function(a,b){$.tmpl('mqLayerControl',{id:b.id,label:b.label,position:b.position(),visible:b.visible()}).data('layer',b).prependTo(a)},_onLayerAdd:function(a,b){a.data.widget._add(a.data.control,b)},_remove:function(a,b){var c="#mq-layercontrol-"+a;var d=$(c);if(!b){d.data('layer').remove()}d.fadeOut(function(){$(this).remove()})},_onLayerRemove:function(a,b){a.data.widget._remove(b,true)}})})(jQuery);(function($){$.template('mqLayerManager','<div class="mq-layermanager ui-widget-content  ">'+'</div>');$.template('mqLayerManagerElement','<div class="mq-layermanager-element ui-widget-content ui-corner-all" id="mq-layermanager-element-${id}">'+'<div class="mq-layermanager-element-header ui-dialog-titlebar  ui-widget-header  ui-corner-all  ui-helper-clearfix"><span class="mq-layermanager-label ui-dialog-title">${label}</span>'+'<a class="ui-dialog-titlebar-close ui-corner-all" href="#" role="button"><span class="ui-icon ui-icon-closethick">close</span></a></div>'+'<div class="mq-layermanager-element-content">'+'<div class="mq-layermanager-element-visibility">'+'<input type="checkbox" class="mq-layermanager-element-vischeckbox" id="${id}-visibility" {{if visible}}checked="${visible}"{{/if}} />'+'<div class="mq-layermanager-element-slider-container"><div class="mq-layermanager-element-slider"></div></div>'+'</div>'+'<div class="mq-layermanager-element-legend">'+'{{if imgUrl}}'+'<img src="${imgUrl}" style="opacity:${opacity}"/>'+'{{/if}}'+'{{if errMsg}}'+'${errMsg}'+'{{/if}}'+'</div>'+'</div>'+'</div>');$.widget("mapQuery.mqLayerManager",{options:{map:undefined,title:"Layer Manager"},_create:function(){var g;var h;var j;var k=this;var l=this.element;g=$(this.options.map).data('mapQuery');this.element.addClass('ui-widget  ui-helper-clearfix '+'ui-corner-all');var m=$.tmpl('mqLayerManager').appendTo(l);l.find('.ui-icon-closethick').button();m.sortable({axis:'y',handle:'.mq-layermanager-element-header',update:function(c,d){var e=d.item.siblings().andSelf();var f=e.length-1;e.each(function(i){var a=$(this).data('layer');var b=f-i;k._position(a,b)})}});$.each(g.layers().reverse(),function(){k._layerAdded(m,this)});l.delegate('.mq-layermanager-element-vischeckbox','change',function(){var a=$(this);var b=a.parents('.mq-layermanager-element');var c=b.data('layer');var d=b.data('self');d._visible(c,a.attr('checked'))});l.delegate('.ui-icon-closethick','click',function(){var a=$(this).parents('.mq-layermanager-element');k._remove(a.data('layer'))});g.bind("mqAddLayer",{widget:k,control:m},k._onLayerAdd);g.bind("mqRemoveLayer",{widget:k,control:m},k._onLayerRemove);g.bind("changelayer",{widget:k,map:g,control:m},k._onLayerChange);g.bind("moveend",{widget:k,map:g,control:m},k._onMoveEnd)},_destroy:function(){this.element.removeClass(' ui-widget ui-helper-clearfix '+'ui-corner-all').empty()},_add:function(a,b){a.layers(b)},_remove:function(a){a.remove()},_position:function(a,b){a.position(b)},_visible:function(a,b){a.visible(b)},_opacity:function(a,b){a.opacity(b)},_layerAdded:function(e,f){var g=this;var h=f.legend().msg;var i;switch(h){case'':i=f.legend().url;if(i==''){h='No legend for this layer'}break;case'E_ZOOMOUT':h='Please zoom out to see this layer';break;case'E_ZOOMIN':h='Please zoom in to see this layer';break;case'E_OUTSIDEBOX':h='This layer is outside the current view';break}var j=$.tmpl('mqLayerManagerElement',{id:f.id,label:f.label,position:f.position(),visible:f.visible(),imgUrl:i,opacity:f.visible()?f.opacity():0,errMsg:h}).data('layer',f).data('self',g).prependTo(e);$(".mq-layermanager-element-slider",j).slider({max:100,step:1,value:f.visible()?f.opacity()*100:0,slide:function(a,b){var c=j.data('layer');var d=j.data('self');d._opacity(c,b.value/100)},change:function(a,b){var c=j.data('layer');var d=j.data('self');if(b.value>=0.01){if(!c.visible()){c.visible(true)}}if(b.value<0.01){if(c.visible()){c.visible(false)}}}})},_layerRemoved:function(a,b){var c=$("#mq-layermanager-element-"+b);c.fadeOut(function(){$(this).remove()})},_layerPosition:function(c,d){var e=c.element.find('.mq-layermanager-element');var f=e.length-1;var g=[];g.length=e.length;e.each(function(){var a=$(this).data('layer');var b=f-a.position();g[b]=this});for(i=0;i<g.length;i++){e.parent().append(g[i])}},_layerVisible:function(a,b){var c=a.element.find('#mq-layermanager-element-'+b.id);var d=c.find('.mq-layermanager-element-vischeckbox');d[0].checked=b.visible();var e=c.find('.mq-layermanager-element-slider');var f=b.visible()?b.opacity()*100:0;e.slider('value',f);c.find('.mq-layermanager-element-legend img').css({visibility:b.visible()?true:'hidden'})},_layerOpacity:function(a,b){var c=a.element.find('#mq-layermanager-element-'+b.id);var d=c.find('.mq-layermanager-element-slider');d.slider('value',b.opacity()*100);c.find('.mq-layermanager-element-legend img').css({opacity:b.opacity()})},_moveEnd:function(a,b,c){b.empty();$.each(c.layers().reverse(),function(){a._layerAdded(b,this)})},_onLayerAdd:function(a,b){a.data.widget._layerAdded(a.data.control,b)},_onLayerRemove:function(a,b){a.data.widget._layerRemoved(a.data.control,b)},_onLayerChange:function(a,b){var c;$.each(a.data.map.layers(),function(){if(this.olLayer.id==b.layer.id){c=this}});switch(b.property){case'opacity':a.data.widget._layerOpacity(a.data.widget,c);break;case'order':a.data.widget._layerPosition(a.data.widget,c);break;case'visibility':a.data.widget._layerVisible(a.data.widget,c);break}},_onMoveEnd:function(a){a.data.widget._moveEnd(a.data.widget,a.data.control,a.data.map)}})})(jQuery);(function($){$.template('mqMousePosition','<div class="mq-mouseposition ui-widget ui-helper-clearfix ">'+'<span class="ui-widget-content ui-helper-clearfix ui-corner-all ui-corner-all">'+'<div id="mq-mouseposition-x" class="mq-mouseposition-coordinate"></div><div id="mq-mouseposition-y" class="mq-mouseposition-coordinate"></div>'+'</div></span>');$.widget("mapQuery.mqMousePosition",{options:{map:undefined,precision:2,x:'x',y:'y'},_create:function(){var a;var b=this;var c=this.element;var d;a=$(this.options.map).data('mapQuery');a.bind("mousemove",{widget:b,map:a},b._onMouseMove);$.tmpl('mqMousePosition',{mouseposition:d}).appendTo(c)},_destroy:function(){this.element.removeClass(' ui-widget ui-helper-clearfix '+'ui-corner-all').empty()},_mouseMoved:function(a,b,c){var x=a.layerX;var y=a.layerY;var d=c.options.projection;var e=c.options.projection;var f=c.olMap.getLonLatFromLayerPx(new OpenLayers.Pixel(x,y));if(c.options.displayProjection){e=c.options.displayProjection;f=f.transform(new OpenLayers.Projection(d),new OpenLayers.Projection(e))}$("#mq-mouseposition-x",b).html(this.options.x+': '+f.lon.toFixed(this.options.precision));$("#mq-mouseposition-y",b).html(this.options.y+': '+f.lat.toFixed(this.options.precision))},_onMouseMove:function(a,b){a.data.widget._mouseMoved(b,a.data.control,a.data.map)}})})(jQuery);(function($){$.template('mqOverviewMap','<div class="mq-overviewmap-button ui-state-default ui-corner-all">'+'<div class="mq-overviewmap-close ui-icon ui-icon-arrowthick-1-se "></div>'+'</div>'+'<div id="${id}" class="mq-overviewmap ui-widget ">'+'</div>');$.widget("mapQuery.mqOverviewMap",{options:{map:undefined,title:"Overview map",position:['right','bottom'],width:300,height:200},_create:function(){var c;var d=this;var e=this.element;var f='mqOverviewMap-dialog';c=$(this.options.map).data('mapQuery');this.element.addClass('ui-widget  ui-helper-clearfix '+'ui-corner-all');$.tmpl('mqOverviewMap',{id:f}).appendTo(e);var g=$('#'+f).dialog({dialogClass:'mq-overviewmap-dialog',autoOpen:true,width:this.options.width,height:this.options.height,title:this.options.title,position:this.options.position,resizeStop:function(a,b){$('.olMap',this).width($(this).width());$('.olMap',this).height($(this).height())},close:function(a,b){$('.mq-overviewmap-close').removeClass('mq-overviewmap-close ui-icon-arrowthick-1-se').addClass('mq-overviewmap-open ui-icon-arrowthick-1-nw')}});var h={w:$(g).width(),h:$(g).height()};var i=c.olMapOptions;delete i.controls;var j=new OpenLayers.Control.OverviewMap({div:document.getElementById(f),size:h,mapOptions:i,layers:[c.layers().reverse()[0].olLayer.clone()]});c.olMap.addControl(j);$('.olControlOverviewMapElement',g).removeClass('olControlOverviewMapElement');e.delegate('.mq-overviewmap-close','click',function(){$(this).removeClass('mq-overviewmap-close ui-icon-arrowthick-1-se').addClass('mq-overviewmap-open ui-icon-arrowthick-1-nw');$('#'+f).dialog('close')});e.delegate('.mq-overviewmap-open','click',function(){$(this).removeClass('mq-overviewmap-open ui-icon-arrowthick-1-nw').addClass('mq-overviewmap-close ui-icon-arrowthick-1-se');$('#'+f).dialog('open')})},_destroy:function(){this.element.removeClass(' ui-widget ui-helper-clearfix '+'ui-corner-all').empty()}})})(jQuery);(function($){$.template('mqPopup','<div class="mq-popup ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+'<span class="ui-dialog-title">${title}</span>'+'<a class="ui-dialog-titlebar-close ui-corner-all" href="#"><span class="ui-icon ui-icon-closethick">close</span></a>'+'</div>'+'<div" class="ui-dialog-content ui-widget-content">{{html contents}}</div>');$.widget("mapQuery.mqPopup",{options:{map:undefined,contents:undefined,title:"Feature Popup",padding:10},_create:function(){var b;var c=this;var d=this.element;b=$(this.options.map).data('mapQuery');var e=$.map(b.layers(),function(a){return a.isVector?a:null});$.each(e,function(){var a=this;a.bind("featureselected",{widget:c,map:b,layer:a},c._onFeatureselected);a.bind("featureunselected",{widget:c},c._onFeatureunselected)});this.element.addClass('ui-dialog ui-widget ui-widget-content '+'ui-corner-all');b.bind("move",{widget:c,map:b},c._onMove)},_destroy:function(){this.element.removeClass('ui-dialog ui-widget ui-widget-content '+'ui-corner-all').empty()},_onFeatureselected:function(a,b){var c=a.data.widget;var d=a.data.map;var e=a.data.layer;var f=c.element;var g=c.options.contents.call(this,b.feature);c.lonLat=$.MapQuery.getFeaturePosition(b.feature);var h=d.pixelsFromPosition(c.lonLat[0],c.lonLat[1]);f.show(0,function(){$(this).css('z-index',e.zIndex()+1000);c._setPosition(d,h)});f.html($.tmpl('mqPopup',{title:c.options.title,contents:g})).find('a.ui-dialog-titlebar-close').bind('click',function(){f.hide();c.lonLat=null;e.unselectFeature(b.feature)});var i=d.element.outerWidth()-(h[0]+f.outerWidth())-c.options.padding;var j=f.outerHeight()-h[1]+c.options.padding;d.pan(i<0?-i:0,j>0?-j:0)},_onFeatureunselected:function(a,b){var c=a.data.widget;c.element.hide();c.lonLat=null},_onMove:function(a,b){var c=a.data.widget;var d=a.data.map;if(!c.lonLat){return}var e=d.pixelsFromPosition(c.lonLat[0],c.lonLat[1]);if(e!==null){c.element.show();c._setPosition(d,e)}else{c.element.hide()}},_setPosition:function(a,b){this.element.position({my:"left bottom",at:"left top",of:a.element,offset:b[0]+' '+b[1],collision:'none'})}})})(jQuery);(function($){$.template('mqZoomButtons','<div class="mq-zoombuttons ui-widget ui-helper-clearfix ">'+'<div class="ui-state-default ui-corner-all"><div class="mq-zoombuttons-plus ui-icon ui-icon-plusthick "></div></div>'+'{{if home}}<div class="ui-state-default ui-corner-all"><div class="mq-zoombuttons-home ui-icon ui-icon-home"></div></div>{{/if}}'+'<div class="ui-state-default ui-corner-all"><div class="mq-zoombuttons-minus ui-icon ui-icon-minusthick"></div></div>'+'</div>');$.widget("mapQuery.mqZoomButtons",{options:{map:undefined,home:false},_create:function(){var a;var b;var c;var d=this;var e=this.element;a=$(this.options.map).data('mapQuery');var f=a.goto();$.tmpl('mqZoomButtons',{home:this.options.home}).appendTo(e);$(".mq-zoombuttons-plus").click(function(){c=a.options.numZoomLevels;b=a.goto().zoom;if(b<c){a.goto({zoom:b+1})}});$(".mq-zoombuttons-home").click(function(){a.goto(f)});$(".mq-zoombuttons-minus").click(function(){b=a.goto().zoom;if(b>0){a.goto({zoom:b-1})}})},_destroy:function(){this.element.removeClass(' ui-widget ui-helper-clearfix '+'ui-corner-all').empty()}})})(jQuery);(function($){$.template('mqZoomSlider','<div class="mq-zoomslider ui-widget ui-helper-clearfix ">'+'<div class="mq-zoomslider-slider"></div>'+'</div>');$.widget("mapQuery.mqZoomSlider",{options:{map:undefined},_create:function(){var c;var d;var e;var f=this;var g=this.element;c=$(this.options.map).data('mapQuery');$.tmpl('mqZoomSlider').appendTo(g);e=c.options.numZoomLevels;$(".mq-zoomslider-slider",g).slider({max:e,min:2,orientation:'vertical',step:1,value:e-c.goto().zoom,slide:function(a,b){c.goto({zoom:e-b.value})},change:function(a,b){c.goto({zoom:e-b.value})}});c.bind("zoomend",{widget:f,map:c,control:g},f._onZoomEnd)},_destroy:function(){this.element.removeClass(' ui-widget ui-helper-clearfix '+'ui-corner-all').empty()},_zoomEnd:function(a,b){var c=a.find('.mq-zoomslider-slider');c.slider('value',b.options.numZoomLevels-b.goto().zoom)},_onZoomEnd:function(a){a.data.widget._zoomEnd(a.data.control,a.data.map)}})})(jQuery);